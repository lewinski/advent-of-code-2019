<?php

require_once __DIR__.'/lib/intcode.php';

$input = file_get_contents(__DIR__.'/../input/7.txt');

$perms = [
    [0,1,2,3,4],
    [0,1,2,4,3],
    [0,1,3,2,4],
    [0,1,3,4,2],
    [0,1,4,2,3],
    [0,1,4,3,2],
    [0,2,1,3,4],
    [0,2,1,4,3],
    [0,2,3,1,4],
    [0,2,3,4,1],
    [0,2,4,1,3],
    [0,2,4,3,1],
    [0,3,1,2,4],
    [0,3,1,4,2],
    [0,3,2,1,4],
    [0,3,2,4,1],
    [0,3,4,1,2],
    [0,3,4,2,1],
    [0,4,1,2,3],
    [0,4,1,3,2],
    [0,4,2,1,3],
    [0,4,2,3,1],
    [0,4,3,1,2],
    [0,4,3,2,1],
    [1,0,2,3,4],
    [1,0,2,4,3],
    [1,0,3,2,4],
    [1,0,3,4,2],
    [1,0,4,2,3],
    [1,0,4,3,2],
    [1,2,0,3,4],
    [1,2,0,4,3],
    [1,2,3,0,4],
    [1,2,3,4,0],
    [1,2,4,0,3],
    [1,2,4,3,0],
    [1,3,0,2,4],
    [1,3,0,4,2],
    [1,3,2,0,4],
    [1,3,2,4,0],
    [1,3,4,0,2],
    [1,3,4,2,0],
    [1,4,0,2,3],
    [1,4,0,3,2],
    [1,4,2,0,3],
    [1,4,2,3,0],
    [1,4,3,0,2],
    [1,4,3,2,0],
    [2,0,1,3,4],
    [2,0,1,4,3],
    [2,0,3,1,4],
    [2,0,3,4,1],
    [2,0,4,1,3],
    [2,0,4,3,1],
    [2,1,0,3,4],
    [2,1,0,4,3],
    [2,1,3,0,4],
    [2,1,3,4,0],
    [2,1,4,0,3],
    [2,1,4,3,0],
    [2,3,0,1,4],
    [2,3,0,4,1],
    [2,3,1,0,4],
    [2,3,1,4,0],
    [2,3,4,0,1],
    [2,3,4,1,0],
    [2,4,0,1,3],
    [2,4,0,3,1],
    [2,4,1,0,3],
    [2,4,1,3,0],
    [2,4,3,0,1],
    [2,4,3,1,0],
    [3,0,1,2,4],
    [3,0,1,4,2],
    [3,0,2,1,4],
    [3,0,2,4,1],
    [3,0,4,1,2],
    [3,0,4,2,1],
    [3,1,0,2,4],
    [3,1,0,4,2],
    [3,1,2,0,4],
    [3,1,2,4,0],
    [3,1,4,0,2],
    [3,1,4,2,0],
    [3,2,0,1,4],
    [3,2,0,4,1],
    [3,2,1,0,4],
    [3,2,1,4,0],
    [3,2,4,0,1],
    [3,2,4,1,0],
    [3,4,0,1,2],
    [3,4,0,2,1],
    [3,4,1,0,2],
    [3,4,1,2,0],
    [3,4,2,0,1],
    [3,4,2,1,0],
    [4,0,1,2,3],
    [4,0,1,3,2],
    [4,0,2,1,3],
    [4,0,2,3,1],
    [4,0,3,1,2],
    [4,0,3,2,1],
    [4,1,0,2,3],
    [4,1,0,3,2],
    [4,1,2,0,3],
    [4,1,2,3,0],
    [4,1,3,0,2],
    [4,1,3,2,0],
    [4,2,0,1,3],
    [4,2,0,3,1],
    [4,2,1,0,3],
    [4,2,1,3,0],
    [4,2,3,0,1],
    [4,2,3,1,0],
    [4,3,0,1,2],
    [4,3,0,2,1],
    [4,3,1,0,2],
    [4,3,1,2,0],
    [4,3,2,0,1],
    [4,3,2,1,0],
];

$max = 0;
foreach ($perms as $phase) {
    $thrust = 0;
    foreach ($phase as $p) {
        $computer = new \Intcode\Computer($input);
        $computer->input([$p, $thrust]);
        $computer->run();
        $thrust = $computer->output();
    }
    $max = max($thrust, $max);
}
echo "day7 part1: $max\n";

$max = 0;
foreach ($perms as $phase) {
    $thrusters = [];
    for ($i = 0; $i < 5; $i++) {
        $computer = new \Intcode\Computer($input);
        $computer->input($phase[$i] + 5);
        $thrusters[] = $computer;
    }
    $thrusters[0]->input(0);    

    $thrust = 0;

    $cur = 0;
    while (true) {
        $next = ($cur + 1) % 5;

        $thrusters[$cur]->run();
        $output = $thrusters[$cur]->output(0);

        if ($cur == 4) {
            $thrust = end($output);
            if ($thrusters[$cur]->isHalted()) {
                break;
            }
        }

        $thrusters[$next]->input($output);
        $cur = $next;
    }

    $max = max($max, $thrust);
}
echo "day7 part2: $max\n";